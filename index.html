<!DOCTYPE html>
<meta charset="utf-8">

	<title>Hoopla</title>

	<script type="text/javascript" src="lib/underscore.js"></script>
	<script type="text/javascript" src="lib/eelens.js"></script>
	<script type="text/javascript" src="lib/canvas.js"></script>
	<script type="text/javascript" src="lib/conrec.js"></script>
	<script type="text/javascript" src="lib/optimize.js"></script>
	<script type="text/javascript" src="hoopla.js"></script>
	<script type="text/javascript">
		var imgd = new Image();
		imgd.crossOrigin="anonymous";
		imgd.src = 'https://cdn.rawgit.com/linan7788626/Hoopla/Preprocessing_input_pics/images/lensed_galaxy.jpg';
		imgd.width = 400;
		imgd.height = 400;
		window.onload = function(e){
			// Create a hoopla object. The ID is that of the <div>
    		var lets = new Hoopla({
				id:'hoopla-srcmodel',
				srcmodel: 'hoopla-srcmodel',
				prediction: 'hoopla-prediction',
				//pixscale: 0.0375
				pixscale: 0.0225
    		});

    		// Using Brian C's Marking Surface library!!!
    		var ms = new MarkingSurface({
				inputName: 'mass-model',
				tool: MarkingSurface.EllipseTool
    		});
    		var containerEl = document.getElementById("marking-container");
    		containerEl.appendChild(ms.el);

    		var img = new Image();
    		img.onload = function() {
				var width = img.width;
				var height = img.height;

				ms.addShape('image', {
					'xlink:href': img.src,
					width: width,
					height: height
				});
				ms.svg.attr({
					width: 400,
					height: 400
				});
				ms.rescale(0, 0, width, height);
				var scaleX = 400 / img.width;
				var scaleY = 400 / img.height;

				function getThetaE(d) {
					var a = d.rx * lets.pixscale;
					var b = d.ry * lets.pixscale;
					return Math.sqrt(a * b);
					//return Math.max(a , b);
				}

				function getAratio(d) {
					var a = d.rx;
					var b = d.ry;
					return a / b;
				}

				function getAngle(d) {
					return d.angle;
				}

				function getCoords(d) {
					return lets.lens.pix2ang({x: scaleX * d.x, y: scaleY * d.y});
				}

				function updateModel() {
					var data = JSON.parse(ms.getValue());
					var components = data.map(function(d) {
						var coords = getCoords(d);
						return {
							plane: "lens",
							theta_e: getThetaE(d),
							ell: getAratio(d),
							ang: getAngle(d),
							x: coords.x,
							y: coords.y
						}
					});
					lets.updateModel(components);
				}
				var debouncedUpdateModel = _.debounce(updateModel, 200);
				ms.on('marking-surface:change', debouncedUpdateModel);
			}
			img.src = "http://raw.githubusercontent.com/linan7788626/linan7788626.github.io/master/images/ering.jpg";

			// Source Models
    		var ms_src = new MarkingSurface({
				inputName: 'src-model',
				tool: MarkingSurface.EllipseTool
    		});
    		var containerEl_src = document.getElementById("marking-container-src");
    		containerEl_src.appendChild(ms_src.el);

    		var img_src = new Image();
    		img_src.onload = function() {
				var width = img_src.width;
				var height = img_src.height;

				ms_src.addShape('image', {
					'xlink:href': img_src.src,
					width: width,
					height: height
				});
				ms_src.svg.attr({
					width: 400,
					height: 400
				});
				ms_src.rescale(0, 0, width, height);
				var scaleX = 400 / img_src.width;
				var scaleY = 400 / img_src.height;

				function getSize(d) {
					var a = d.rx * lets.pixscale;
					var b = d.ry * lets.pixscale;
					return Math.sqrt(a * b);
					//return Math.max(a , b);
				}

				function getAratio(d) {
					var a = d.rx;
					var b = d.ry;
					return a / b;
				}

				function getAngle(d) {
					return d.angle;
				}

				function getCoords(d) {
					return lets.lens.pix2ang({x: scaleX * d.x, y: scaleY * d.y});
				}

				function updateModel() {
					var data = JSON.parse(ms_src.getValue());
					var components = data.map(function(d) {
						var coords = getCoords(d);
						return {
							plane: "source",
							size: getSize(d),
							ell: getAratio(d),
							ang: getAngle(d),
							x: coords.x,
							y: coords.y
						}
					});
					lets.updateModel(components);
				}
				var debouncedUpdateModel = _.debounce(updateModel, 200);
				ms_src.on('marking-surface:change', debouncedUpdateModel);
			}
			img_src.src = "http://raw.githubusercontent.com/linan7788626/linan7788626.github.io/master/images/ering.jpg";

			document.getElementById('imageUpload').onchange = function(e) {
				var imageFile = this.files[0];
				var url = window.URL.createObjectURL(imageFile);
				img.src = url;
				img_src.src = url;
				document.getElementById("hoopla-srcmodel").style.backgroundImage
					= "url(" + url + ")";
				document.getElementById("hoopla-prediction").style.backgroundImage
					= "url(" + url + ")";
			};

			document.getElementById("showModels").onclick = function fun() {
				//lets.showModels(img_src.src.split('/')[img_src.src.split('/').length-1].split('.')[0]+'.JSON');
				lets.showModels(img_src.src);
			};

			document.getElementById('buttonExecute').onclick = function passURL() {
				url = document.getElementById('textbox1').value
				img.src = url;
				img_src.src = url;
				document.getElementById("hoopla-srcmodel").style.backgroundImage
					= "url(" + url + ")";
				document.getElementById("hoopla-prediction").style.backgroundImage
					= "url(" + url + ")";
			};

			document.getElementById('modelUpload').onchange = function(e) {
				var input = e.target;

				var reader = new FileReader();
				reader.onload = function(){
					var text = reader.result;
					var data = JSON.parse(text);
					lets.loadModel(data.components);
				};
				reader.readAsText(input.files[0]);
			};

			function calAlpha(xl,yl,xlc,ylc,re,ql,phl) {

				if(ql <1.0){
					ql = ql;
					phl = Math.PI * ((-phl+90) / 180);
				}else{
					ql = 1.0/ql-0.0000000001;
					phl = Math.PI * (-phl / 180);
				}

				var	alpha = { x: 0.0, y: 0.0 };
				var x,y,cs, sn;
				var sx_r, sy_r, psi, sq, pd1, pd2, fx1, fx2, qs, a1, a2;
				var rc = 0.0;
			
				cs = Math.cos(phl);
				sn = Math.sin(phl);
			
				x = xl - xlc;
				y = yl - ylc;
			
				sx_r = x * cs + y * sn;
				sy_r = -x * sn + y * cs;
			
				psi = Math.sqrt(ql*ql*(rc*rc+sx_r*sx_r)+sy_r*sy_r);
			
				sq = Math.sqrt(1.0-ql*ql);
				pd1 = psi + rc;
				pd2 = psi + rc*ql*ql;
				fx1 = sq * sx_r / pd1;
				fx2 = sq * sy_r / pd2;
				qs = Math.sqrt(ql);
			
				a1 = qs / sq * Math.atan(fx1);
				a2 = qs / sq * Math.atanh(fx2);
			
				dx = (a1 * cs - a2 * sn);
				dy = (a2 * cs + a1 * sn);
			
				// Add lensing effects of just this component:
				alpha.x = re*dx;
				alpha.y = re*dy;
				return alpha;
			}

			function calImage(xs, ys, xsc, ysc, sig2, qs, phs) {
				var r2, res, phirad;
				// Loop over x and y. Store 1-D pixel index as i.
				phirad = -phs/180*Math.PI;
				var xnew = (xs-xsc) * Math.cos(phirad) + (ys-ysc) * Math.sin(phirad)
				var ynew = (ys-ysc) * Math.cos(phirad) - (xs-xsc) * Math.sin(phirad)
				r2 = ( xnew*xnew/qs + ynew*ynew*qs );
				res = Math.exp(-r2/(2.0*sig2*sig2*0.693));
				return res; // Allow this function to be chainable
			}

			function model_lensed_images(p, x1, x2) {
				var xc1, xc2, re, ql, phl;
				xc1 = p[0];
				xc2 = p[1];
				re = p[2];
				ql = p[3];
				phl = p[4];

				var alpha = calAlpha(x1,x2,xc1,xc2,re,ql,phl); 

				var y1 = x1 - alpha.x;
				var y2 = x2 - alpha.y;

				var yc1, yc2, sig2, qs, phs;
				yc1 = p[5];
				yc2 = p[6];
				sig2 = p[7];
				qs = p[8];
				phs = p[9];

				var res = calImage(y1,y2,yc1,yc2,sig2,qs,phs);
				return res;
			}

			function chi2_2(p) {
				var predictedimage = [];
				var alpha = []
						
				for(var i = 0 ; i < imgd.width*imgd.height ; i++){
					alpha[i] = { x: 0.0, y: 0.0 };
					predictedimage[i] = 0;
				}
				// Declare outside the for loop for efficiency
				var x, y;
				var tr, cs, sn;
				var rc = 0.0;
				var ql;
				// Loop over pixels:
				for(var i = 0 ; i < imgd.width*imgd.height ; i++){
					// Loop over lens components:
						if(p[3] <1.0){
							ql = p[3];
							tr = Math.PI * ((-p[4]+90) / 180);
						}else{
							ql = 1.0/p[3]-0.0000000001;
							tr = Math.PI * (-p[4] / 180);
						}
				
						cs = Math.cos(tr);
						sn = Math.sin(tr);
				
						x = i % imgd.width - p[0]/lets.pixscale;
						y = Math.floor(i/imgd.width) - p[1]/lets.pixscale;
				
						sx_r = x * cs + y * sn;
						sy_r = -x * sn + y * cs;
				
						psi = Math.sqrt(ql*ql*(rc*rc+sx_r*sx_r)+sy_r*sy_r);
				
						sq = Math.sqrt(1.0-ql*ql);
						pd1 = psi + rc;
						pd2 = psi + rc*ql*ql;
						fx1 = sq * sx_r / pd1;
						fx2 = sq * sy_r / pd2;
						qs = Math.sqrt(ql);
				
						a1 = qs / sq * Math.atan(fx1);
						a2 = qs / sq * Math.atanh(fx2);
				
						dx = (a1 * cs - a2 * sn);
						dy = (a2 * cs + a1 * sn);
				
						// Add lensing effects of just this component:
						alpha[i].x = p[2]/lets.pixscale*dx;
						alpha[i].y = p[2]/lets.pixscale*dy;
				}
				
				var d = { x: 0, y: 0 };
				var i = 0;
				var r2 = 0;
				// Since for a Gaussian, half light radius (size) = sigma * sqrt(2*ln(2))
				//var factor = 1.0/(0.693*this.source[0].size_px*this.source[0].size_px)
				var sig2 = p[7]*p[7]*0.693/lets.pixscale/lets.pixscale;
				var row, col, s, v;
				for(row = 0 ; row < imgd.width ; row++){
					for(col = 0 ; col < imgd.height ; col++){
							d.x = col - p[5]/lets.pixscale - alpha[i].x+4.5;
							d.y = row - p[6]/lets.pixscale - alpha[i].y+4.5;
							phirad = -p[9]/180*Math.PI;
							xnew = d.x * Math.cos(phirad) + d.y * Math.sin(phirad)
							ynew = d.y * Math.cos(phirad) - d.x * Math.sin(phirad)
							r2 = ( xnew*xnew/p[8] + ynew*ynew*p[8] );
							v = Math.exp(-r2/(2.0*sig2));
						predictedimage[i++] = v;
					}
				}
				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
				ctx.drawImage(imgd, 0, 0);
				var dstdata = ctx.getImageData(0, 0, imgd.width, imgd.height);
				var data = dstdata.data;

				var red = new Array(data.length/4);
				for(var i = 0, n = red.length; i < n; i ++) {
					red[i] = data[i*4]/255.;
				}

			
				var chi = new Array(red.length);
				var testimg = new Array(red.length);
				for(var i = 0 ; i < imgd.width*imgd.height ; i++){
			        chi[i] = (red[i] - predictedimage[i])*red[i]*red[i];
						//console.log([red[i], testimg[i]]);
			    }
			    var res = optimize.vector.dot(chi, chi);
				console.log(res);

				for (var y = 0; y < imgd.width; ++y) {
				    for (var x = 0; x < imgd.height; ++x) {
				        var index = (y * imgd.width + x) * 4;
						var index2 = (y * imgd.width + x);
				
				        //data[index]   = Math.floor(red[index2]*255);    // red
				        //data[index]   = Math.floor(testimg[index2]*255);    // red
						data[index]   = Math.floor(Math.abs(testimg[index2]-red[index2])*255);    // red
				        //data[index]   = 128;    // red
				        data[++index] = 0;    // green
				        data[++index] = 0;    // blue
				        data[++index] = 255;      // alpha
				    }
				}

				dstdata.data = data;
				ctx.putImageData(dstdata, 0, 0);
				return res;
			}

			function standardDeviation(values){
				var avg = average(values);
				
				var squareDiffs = values.map(function(value){
					var diff = value - avg;
					var sqrDiff = diff * diff;
					return sqrDiff;
				});
				
				var avgSquareDiff = average(squareDiffs);
				
				var stdDev = Math.sqrt(avgSquareDiff);
				return stdDev;
			}

			function average(data){
				var sum = data.reduce(function(sum, value){
					return sum + value;
				}, 0);
			
				var avg = sum / data.length;
				return avg;
			}
			function chi2_rescale(p) {
				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
				ctx.drawImage(imgd, 0, 0);
				var dstdata = ctx.getImageData(0, 0, imgd.width, imgd.height);
				var data = dstdata.data;

				var red = new Array(data.length/4);
				for(var i = 0, n = red.length; i < n; i ++) {
					red[i] = data[i*4]/255.;
				}
			
				var fscale = 4;
				var chi = new Array(red.length/fscale/fscale);
				var testimg = new Array(red.length);
				var redstd = standardDeviation(red);
				for(var row = 0 ; row < imgd.width ; row+=fscale){
					for(var col = 0 ; col < imgd.height ; col+=fscale){
						i = row*imgd.height+col;
						i2 = row/fscale*imgd.height/fscale+col/fscale;
						x = col*0.0225 - 4.5;
						y = row*0.0225 - 4.5;
			        	testimg[i] = model_lensed_images(p, x, y);
			        	chi[i2] = (red[i] -
								testimg[i])/redstd/redstd/(chi.length);
					}
			    }
			    var res = optimize.vector.dot(chi, chi);
				console.log(res);

				return res;
			}

			function chi2(p) {
			    var i;
				//var red = getRedData();
				//var canvas = document.createElement('canvas');

				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
				ctx.drawImage(imgd, 0, 0);
				var dstdata = ctx.getImageData(0, 0, imgd.width, imgd.height);
				var data = dstdata.data;

				var red = new Array(data.length/4);
				for(var i = 0, n = red.length; i < n; i ++) {
					red[i] = data[i*4]/255.;
				}

			
				var chi = new Array(red.length);
				var testimg = new Array(red.length);
				var redstd = standardDeviation(red);
				for(var row = 0 ; row < 400 ; row++){
					for(var col = 0 ; col < 400 ; col++){
						i = row*400+col;
						x = col*0.0225 - 4.5;
						y = row*0.0225 - 4.5;
			        	testimg[i] = model_lensed_images(p, x, y);
			        	//chi[i] = (red[i] - testimg[i])*red[i]*red[i];
			        	chi[i] = (red[i] - testimg[i])/redstd/redstd;
						//console.log([red[i], testimg[i]]);
					}
			    }
			    var res = optimize.vector.dot(chi, chi);
				console.log(res);

				//for (var y = 0; y < imgd.width; ++y) {
				//    for (var x = 0; x < imgd.height; ++x) {
				//        var index = (y * imgd.width + x) * 4;
				//		var index2 = (y * imgd.width + x);
				//
				//        //data[index]   = Math.floor(red[index2]*255);    // red
				//        //data[index]   = Math.floor(testimg[index2]*255);    // red
				//		data[index]   = Math.floor(Math.abs(testimg[index2]-red[index2])*255);    // red
				//        //data[index]   = 128;    // red
				//        data[++index] = 0;    // green
				//        data[++index] = 0;    // blue
				//        data[++index] = 255;      // alpha
				//    }
				//}

				//dstdata.data = data;
				//ctx.putImageData(dstdata, 0, 0);
				return res;
			}

			function show_res(p) {
			    var i;

				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
				ctx.drawImage(imgd, 0, 0);
				var dstdata = ctx.getImageData(0, 0, imgd.width, imgd.height);
				var data = dstdata.data;

				var red = new Array(data.length/4);
				for(var i = 0, n = red.length; i < n; i ++) {
					red[i] = data[i*4]/255.;
				}

			
				var chi = new Array(red.length);
				var testimg = new Array(red.length);
				var redstd = standardDeviation(red);
				for(var row = 0 ; row < 400 ; row++){
					for(var col = 0 ; col < 400 ; col++){
						i = row*400+col;
						x = col*0.0225 - 4.5;
						y = row*0.0225 - 4.5;
			        	testimg[i] = model_lensed_images(p, x, y);
			        	//chi[i] = (red[i] - testimg[i])*red[i]*red[i];
			        	chi[i] = (red[i] - testimg[i])/redstd/redstd;
					}
			    }
			    var res = optimize.vector.dot(chi, chi);
				console.log(res);

				for (var y = 0; y < imgd.width; ++y) {
				    for (var x = 0; x < imgd.height; ++x) {
				        var index = (y * imgd.width + x) * 4;
						var index2 = (y * imgd.width + x);
				
				        //data[index]   = Math.floor(red[index2]*255);    // red
				        //data[index]   = Math.floor(testimg[index2]*255);    // red
						data[index]   = Math.floor(Math.abs(testimg[index2]-red[index2])*255);    // red
				        //data[index]   = 128;    // red
				        data[++index] = 0;    // green
				        data[++index] = 0;    // blue
				        data[++index] = 255;      // alpha
				    }
				}

				dstdata.data = data;
				ctx.putImageData(dstdata, 0, 0);
				return res;
			}

			document.getElementById("optimitzation").onclick = function do_fit(p0) {
				var p0 = new Array(10);
				var xc1,xc2,re,ql,phl;

				xc1 = lets.models[0].components[1].x;
				xc2 = lets.models[0].components[1].y;
				re  = lets.models[0].components[1].theta_e;
				ql  = lets.models[0].components[1].ell;
				phl = lets.models[0].components[1].ang;
				var yc1,yc2,sig2,qs,phs;
				yc1 = lets.models[0].components[0].x;
				yc2 = lets.models[0].components[0].y;
				sig2= lets.models[0].components[0].size;
				qs  = lets.models[0].components[0].ell;
				phs = lets.models[0].components[0].ang;

				p0 = [xc1,xc2,re,ql,phl,yc1,yc2,sig2,qs,phs];
				//chi2(p0);
			    p1 = optimize.fmin(chi2_rescale, p0, {ftol: 1e-6, maxiter: 1000});
				console.log(p0);
				console.log(p1);
				show_res(p1);


				lets.models[0].components[1].x = p1[0];
				lets.models[0].components[1].y = p1[1];
				lets.models[0].components[1].theta_e = p1[2];
				lets.models[0].components[1].ell = p1[3];
				lets.models[0].components[1].ang = p1[4];
				lets.models[0].components[0].x = p1[5];
				lets.models[0].components[0].y = p1[6];
				lets.models[0].components[0].size = p1[7];
				lets.models[0].components[0].ell = p1[8];
				lets.models[0].components[0].ang = p1[9];
				lets.loadModel(lets.models[0].components);
				lets.update();
				console.log(lets.models[0].components);
			};    
		}
	</script>

	<style type="text/css">
		body {
			font-family: serif,Helvetica,Arial,sans-serif;
			background-color: black;
			color: #ffffff;
		}

		.container {
			width: 840px;
		}

		h1, h2, h3, h4 { font-family: Arial,serif; }
		h1 { margin-bottom: 0.5em; color: #FFFFFF; }

		h4 { color: #666666; }
		a { color: #666666; }

		.inline {
		    position: relative;
		    display: inline;
		    margin-left: 5px;
		}

		.inline-block {
		    display: inline-block;
		}

		.captions {
			font-size:20px;
			font-weight: bold;
		    display: block;
		    height: 40px;
		}

		#masscaption,#srcincaption {
			padding-top:100;
			border: 1px solid #666666;
			background-color: #666666;
			width: 380px;
			color: #ffffff;
			padding-left: 20px;
			margin-bottom: 50;
		}

		#srccaption, #predcaption {
			padding-top:100;
			border: 1px solid #666666;
			background-color: #666666;
			width: 380px;
			color: #ffffff;
			padding-left: 20px;
			margin-bottom: 50;
		}

		.bar {
			width: 400px;
			height: 400px;
			float: left;
			margin: 5px;
			margin-bottom: 5px;
			border: 1px solid #666666;
			/* background-image:
			   url("http://lenszoo.files.wordpress.com/2013/12/asw0009cjs-zoomed.jpg");
			   */
			background-image: url("http://raw.githubusercontent.com/linan7788626/linan7788626.github.io/master/images/ering.jpg");
			background-size: 400px 400px
		}
		.barTitle {
			font-family: Arial,serif;
			padding-bottom:20px;
			font-size:22px;
			font-weight: bold;
			width: 400px;
			height: 20px;
			float: left;
			margin: 5px;
			margin-bottom: -5px;
			border: 1px solid #666666;
			background-color:#666666;
		}

		.greywords {
			color: #666666;
		}

		#footer {
			position:absolute;
			color: #666666;
			bottom:0;
			margin-bottom:40px;
			width:100%;
			height:100px;   /* Height of the footer */
		}

		.button {
			display: inline-block;
			border-radius: 2px;
			background-color: #0f79ac;
			border: none;
			color: #FFFFFF;
			text-align: center;
			font-size: 18px;
			padding: 10px;
			width: 200px;
			transition: all 0.5s;
			cursor: pointer;
			margin: 5px;
		}

		.button span {
			cursor: pointer;
			display: inline-block;
			position: relative;
			transition: 0.5s;
		}

		.button span:after {
			content: 'Â»';
			position: absolute;
			opacity: 0;
			top: 0;
			right: -20px;
			transition: 0.5s;
		}

		.button:hover span {
			padding-right: 25px;
		}

		.button:hover span:after {
			opacity: 1;
			right: 0;
		}

		#homebutton {
			position: absolute;
			left: 1035px;
			top: 30px;
		}

		.Uploadbtn {
			position: relative;
			overflow: hidden;

			display: inline-block;
			border-radius: 2px;
			background-color: #0f79ac;
			border: none;
			color: #FFFFFF;
			text-align: center;
			font-size: 18px;
			padding: 10px;
			width: 200px;
			transition: all 0.5s;
			cursor: pointer;
			margin: 5px;
		}

		.Uploadbtn .input-upload {
			position: absolute;
			top: 0;
			right: 0;
			margin: 0;
			padding: 0;
			opacity: 0;
			height:100%;
			width:100%;
		}

		#textbox1 {
			border: 0px #666666;
			border-radius: 2px;
			font-size: 18px;
			margin: 5px;
			margin-bottom: 0px;
			padding: 10px;
			width: 620px;
			height: 20px;
		}

		.wrapper {
			margin: 5px;
			background-color: #666666;
			border:0px solid #666666;
			border-radius: 2px;
			display:inline-block;
		}

	</style>

<body>
	<div>
		<header class="inner">
			<h1>Hoopla</h1>
			<h4><a href="https://github.com/linan7788626/hoopla">Lens
					Modeling in Javascript</a> with Elliptical Lenses and Sources</h4>
		</header>
	</div>

    <a href="https://github.com/linan7788626/Hoopla"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

	<div class="container">
		<div id="masscaption" class="barTitle">
			<p style="margin-top: 10px;margin-left: -8px;">Mass Model</p>

		</div>
		<div id="srccaption" class="barTitle">
			<p style="margin-top: 10px;margin-left: -8px;">Source Model</p>
		</div>
	</div>
	<div class="container">
		<div id="marking-container" class="bar"></div>
		<div id="marking-container-src" class="bar" style="color: #666666;"></div>
	</div>
	<div class="container">
		<div id="masscaption" class="barTitle">
			<p style="margin-top: 10px;margin-left: -8px;">Source Plane</p>
		</div>
		<div id="srccaption" class="barTitle">
			<p style="margin-top: 10px;margin-left: -8px;">Image Plane</p>
		</div>
	</div>

	<div class="container">
		<div id="hoopla-srcmodel" class="bar"></div>
		<div id="hoopla-prediction" class="bar"></div>
	</div>
	<div class="container">
	<button class="button" id="showModels"
			style="vertical-align:middle;width:193px;background-color:#666666"><span>Save Models</span></button>
	<button class="Uploadbtn" style="vertical-align:middle;width:193px;background-color:#666666">
		<input class="input-upload" type="file" id="modelUpload"/>
		<span>Load Models</span>
	</button>

	<button class="Uploadbtn" style="vertical-align:middle;width:193px;background-color:#666666">
		<input class="input-upload" type="file" id="imageUpload"/>
		<span>Upload Images</span>
	</button>

	<button class="button" id="optimitzation"
			style="vertical-align:middle;width:193px"><span>Optimization</span></button>

	<div class="wrapper">
		<input id="textbox1" type="text" placeholder="Input the URL of an Image"/>
		<button class="button" id="buttonExecute" style="width:150px;background-color:#666666"
		><span>Upload URL</span></button>
	</div>
	</div>

	<div class="container">
		<div class="article">
			<p>	<br/>
			<br/>
			Drag your mouse in the blocks "Mass Model" and "Source Model" to <br/>
			draw ellipses, then move the cursor in the "Source Plane" block. Can <br/>
			you discover anything interesting in the "Image Plane" block? Can <br/>
			you reconstruct the Einstein Ring using your mouse? If you <br/>
			reconstruct the lensed images successfully, you can use left click <br/>
			on the block "Source Plane" to activate freeze-model, then click the <br/>
			button "Save Lens Models" to save your model. If you would like <br/>
			to email the model to <a href="mailto:linan7788626@gmail.com">linan7788626@gmail.com</a>, <br/>
			I really appreciate it. <br/>
			Have Fun!<br/>
			</p>
		</div>
	</div>

	<div class="container">
	<footer>
		<p class="greywords"><a
			href="https://github.com/linan7788626/Hoopla">Hoopla</a>
			is based on <a href="https://github.com/drphilmarshall/LensWrangler">
			LensWrangler</a> by <a href="https://github.com/drphilmarshall">Phil Marshall</a>, <a href="https://github.com/kapadia">Amit Kapadia</a> and <a href="https://github.com/slowe">Stuart Lowe</a>,<br/>
            but with modifications by <a href="https://github.com/linan7788626">Nan Li</a>. <br/>
	        This page is published with <a href="http://pages.github.com">GitHub Pages</a>. <br/>
		</p>
	</footer>
	<a href="http://linan7788626.github.io">
		<button class="button" style="vertical-align:middle">
			<span>Go Back</span>
		</button>
	</a>
	</div>

	<canvas id="myCanvas" width="400" height="400" style="border:1px solid #d3d3d3;">
		Your browser does not support the HTML5 canvas tag.
	</canvas>

    <script type="text/javascript" src="lib/marking/marking-surface.js"></script>
    <script type="text/javascript" src="lib/marking/tools/ellipse.js"></script>
</body>
